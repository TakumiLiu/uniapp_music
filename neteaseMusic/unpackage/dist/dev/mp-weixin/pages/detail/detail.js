(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/detail/detail"],{166:function(e,t,n){"use strict";(function(e){n(5);i(n(3));var t=i(n(167));function i(e){return e&&e.__esModule?e:{default:e}}wx.__webpack_require_UNI_MP_PLUGIN__=n,e(t.default)}).call(this,n(1)["createPage"])},167:function(e,t,n){"use strict";n.r(t);var i=n(168),o=n(170);for(var s in o)"default"!==s&&function(e){n.d(t,e,(function(){return o[e]}))}(s);n(172);var c,r=n(13),a=Object(r["default"])(o["default"],i["render"],i["staticRenderFns"],!1,null,"3e159eb4",null,!1,i["components"],c);a.options.__file="pages/detail/detail.vue",t["default"]=a.exports},168:function(e,t,n){"use strict";n.r(t);var i=n(169);n.d(t,"render",(function(){return i["render"]})),n.d(t,"staticRenderFns",(function(){return i["staticRenderFns"]})),n.d(t,"recyclableRender",(function(){return i["recyclableRender"]})),n.d(t,"components",(function(){return i["components"]}))},169:function(e,t,n){"use strict";var i;n.r(t),n.d(t,"render",(function(){return o})),n.d(t,"staticRenderFns",(function(){return c})),n.d(t,"recyclableRender",(function(){return s})),n.d(t,"components",(function(){return i}));try{i={musichead:function(){return n.e("components/musichead/musichead").then(n.bind(null,254))}}}catch(r){if(-1===r.message.indexOf("Cannot find module")||-1===r.message.indexOf(".vue"))throw r;console.error(r.message),console.error("1. 排查组件名称拼写是否正确"),console.error("2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom"),console.error("3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件")}var o=function(){var e=this,t=e.$createElement;e._self._c},s=!1,c=[];o._withStripped=!0},170:function(e,t,n){"use strict";n.r(t);var i=n(171),o=n.n(i);for(var s in i)"default"!==s&&function(e){n.d(t,e,(function(){return i[e]}))}(s);t["default"]=o.a},171:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=n(154),o={data:function(){return{curHeight:0,scrollY:0,songDetail:{al:{picUrl:""}},songSimi:[],songComment:[],songLyric:[],lyricIndex:0,iconplay:"icon-zanting",isPlayRotate:!0,isLoading:!0,check:!0,nowdirection:0,currentTime:0,maxTime:"",nowtime:0,musicId:"",songList:[],useremail:"",status:"",songid:""}},watch:{lyricIndex:function(t,n){var i=this,o=this;e.createSelectorQuery().in(o).selectAll(".detail-lyric-item").boundingClientRect((function(o){var s=o;if(t-n>1){for(var c=i.scrollY,r=n;r<t;r++)c+=s[r].height;i.scrollY=c}else if(t-n<1){for(var a=i.scrollY,u=n;u>t;u--)a-=s[u].height;i.scrollY=a}else n-t==1?e.createSelectorQuery().in(i).select(".active").boundingClientRect((function(e){i.curHeight=e.height,i.scrollY=i.scrollY-i.curHeight})).exec():i.scrollY=s[t].height+i.scrollY})).exec()}},onLoad:function(e){this.getMusic(e.songId),this.checkcollect(e.songId)},onUnload:function(){this.cancelLyricIndex()},onHide:function(){this.cancelLyricIndex()},methods:{getMusic:function(t){var n=this;this.songid=t,this.$store.commit("NEXT_ID",t),e.showLoading({title:"正在加载..."}),this.isLoading=!0,this.musicId=t,Promise.all([(0,i.songDetail)(t),(0,i.songSimi)(t),(0,i.songComment)(t),(0,i.songLyric)(t),(0,i.songUrl)(t)]).then((function(t){if("200"==t[0][1].data.code&&(n.songDetail=t[0][1].data.songs[0]),"200"==t[1][1].data.code&&(n.songSimi=t[1][1].data.songs),"200"==t[2][1].data.code&&(n.songComment=t[2][1].data.hotComments),"200"==t[3][1].data.code){var i=t[3][1].data.lrc.lyric,o=/\[([^\]]+)\]([^\[]+)/g,s=[];i.replace(o,(function(e,t,i){s.push({time:n.formatTimeToSec(t),lyric:i})})),n.songLyric=s.filter((function(e){return 10!==e.lyric.charCodeAt(0)}))}if("200"==t[4][1].data.code){var c=e.getBackgroundAudioManager();c.title=n.songDetail.name,c.src=t[4][1].data.data[0].url||"",n.bgAudioManager=c,n.listenLyricIndex(),c.onPlay((function(){n.iconplay="icon-zanting",n.isPlayRotate=!0,n.listenLyricIndex()})),c.onTimeUpdate((function(){n.nowtime=c.currentTime})),c.onPause((function(){n.iconplay="icon-bofang1",n.isPlayRotate=!1,n.cancelLyricIndex()})),c.onEnded((function(){n.handleToNext()}))}n.maxTime=n.songDetail.dt/1e3,e.getStorage({key:"song_list",success:function(e){n.songList=e.data}}),n.isLoading=!1,e.hideLoading()}))},formatTimeToSec:function(e){var t=e.split(":");return(Number(60*t[0])+Number(t[1])).toFixed(1)},handleToPlay:function(){this.bgAudioManager.paused?this.bgAudioManager.play():this.bgAudioManager.pause()},handleToLast:function(){var t,n;for(n in this.songList)this.songDetail.id==this.songList[n]&&(t=0==n?this.songList[this.songList.length-1]:this.songList[Number(n)-1]);e.redirectTo({url:"/pages/detail/detail?songId="+t})},handleToNext:function(){var t,n;for(n in this.songList)this.songDetail.id==this.songList[n]&&(t=n==this.songList.length-1?this.songList[0]:this.songList[Number(n)+1]);e.redirectTo({url:"/pages/detail/detail?songId="+t})},listenLyricIndex:function(){var e=this;clearInterval(this.timer),this.timer=setInterval((function(){for(var t=0;t<e.songLyric.length;t++){if(e.bgAudioManager.currentTime>e.songLyric[e.songLyric.length-1].time){e.lyricIndex=e.songLyric.length-1;break}e.bgAudioManager.currentTime>e.songLyric[t].time&&e.bgAudioManager.currentTime<e.songLyric[t+1].time&&(e.lyricIndex=t)}}),90)},cancelLyricIndex:function(){clearInterval(this.timer)},handleToSimi:function(e){this.getMusic(e)},MillisecondToDate:function(e){var t=new Date(e);function n(e){return e<10?"0"+e:e}return n(t.getMinutes())+":"+n(t.getSeconds())},checkcollect:function(e){var t=this;this.$u.utils.isLogin()?(0,i.userInfo)().then((function(e){t.useremail=e.data.email,(0,i.userCheckCollectMusicId)(t.useremail,t.songid).then((function(e){t.status=e.message,"true"==t.status?t.check=!1:t.check=!0}))})):this.check=!0},collect:function(e){this.$u.utils.isLogin()?(this.$u.toast("收藏成功"),(0,i.userCollectMusic)(this.useremail,e),this.check=!1):this.$u.toast("请先登录再收藏")},discollect:function(e){this.$u.utils.isLogin()?(this.$u.toast("取消收藏成功"),(0,i.userDisCollectMusic)(this.useremail,e),this.check=!0):this.$u.toast("请先登录再取消收藏")},moved:function(e){this.bgAudioManager.seek(e.detail.value),this.nowtimes=e.detail.value}}};t.default=o}).call(this,n(1)["default"])},172:function(e,t,n){"use strict";n.r(t);var i=n(173),o=n.n(i);for(var s in i)"default"!==s&&function(e){n.d(t,e,(function(){return i[e]}))}(s);t["default"]=o.a},173:function(e,t,n){}},[[166,"common/runtime","common/vendor"]]]);
//# sourceMappingURL=../../../.sourcemap/mp-weixin/pages/detail/detail.js.map