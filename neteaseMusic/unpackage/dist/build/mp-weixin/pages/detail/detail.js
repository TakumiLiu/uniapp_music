(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/detail/detail"],{"358c":function(t,i,e){"use strict";e.r(i);var n=e("4171"),o=e.n(n);for(var s in n)"default"!==s&&function(t){e.d(i,t,(function(){return n[t]}))}(s);i["default"]=o.a},4171:function(t,i,e){"use strict";(function(t){Object.defineProperty(i,"__esModule",{value:!0}),i.default=void 0;var n=e("508f"),o={data:function(){return{curHeight:0,scrollY:0,songDetail:{al:{picUrl:""}},songSimi:[],songComment:[],songLyric:[],lyricIndex:0,iconplay:"icon-zanting",isPlayRotate:!0,isLoading:!0,check:!0,nowdirection:0,currentTime:0,maxTime:"",nowtime:0,musicId:"",songList:[],useremail:"",status:"",songid:""}},watch:{lyricIndex:function(i,e){var n=this,o=this;t.createSelectorQuery().in(o).selectAll(".detail-lyric-item").boundingClientRect((function(o){var s=o;if(i-e>1){for(var c=n.scrollY,a=e;a<i;a++)c+=s[a].height;n.scrollY=c}else if(i-e<1){for(var r=n.scrollY,u=e;u>i;u--)r-=s[u].height;n.scrollY=r}else e-i==1?t.createSelectorQuery().in(n).select(".active").boundingClientRect((function(t){n.curHeight=t.height,n.scrollY=n.scrollY-n.curHeight})).exec():n.scrollY=s[i].height+n.scrollY})).exec()}},onLoad:function(t){this.getMusic(t.songId),this.checkcollect(t.songId)},onUnload:function(){this.cancelLyricIndex()},onHide:function(){this.cancelLyricIndex()},methods:{getMusic:function(i){var e=this;this.songid=i,this.$store.commit("NEXT_ID",i),t.showLoading({title:"正在加载..."}),this.isLoading=!0,this.musicId=i,Promise.all([(0,n.songDetail)(i),(0,n.songSimi)(i),(0,n.songComment)(i),(0,n.songLyric)(i),(0,n.songUrl)(i)]).then((function(i){if("200"==i[0][1].data.code&&(e.songDetail=i[0][1].data.songs[0]),"200"==i[1][1].data.code&&(e.songSimi=i[1][1].data.songs),"200"==i[2][1].data.code&&(e.songComment=i[2][1].data.hotComments),"200"==i[3][1].data.code){var n=i[3][1].data.lrc.lyric,o=/\[([^\]]+)\]([^\[]+)/g,s=[];n.replace(o,(function(t,i,n){s.push({time:e.formatTimeToSec(i),lyric:n})})),e.songLyric=s.filter((function(t){return 10!==t.lyric.charCodeAt(0)}))}if("200"==i[4][1].data.code){var c=t.getBackgroundAudioManager();c.title=e.songDetail.name,c.src=i[4][1].data.data[0].url||"",e.bgAudioManager=c,e.listenLyricIndex(),c.onPlay((function(){e.iconplay="icon-zanting",e.isPlayRotate=!0,e.listenLyricIndex()})),c.onTimeUpdate((function(){e.nowtime=c.currentTime})),c.onPause((function(){e.iconplay="icon-bofang1",e.isPlayRotate=!1,e.cancelLyricIndex()})),c.onEnded((function(){e.handleToNext()}))}e.maxTime=e.songDetail.dt/1e3,t.getStorage({key:"song_list",success:function(t){e.songList=t.data}}),e.isLoading=!1,t.hideLoading()}))},formatTimeToSec:function(t){var i=t.split(":");return(Number(60*i[0])+Number(i[1])).toFixed(1)},handleToPlay:function(){this.bgAudioManager.paused?this.bgAudioManager.play():this.bgAudioManager.pause()},handleToLast:function(){var i,e;for(e in this.songList)this.songDetail.id==this.songList[e]&&(i=0==e?this.songList[this.songList.length-1]:this.songList[Number(e)-1]);t.redirectTo({url:"/pages/detail/detail?songId="+i})},handleToNext:function(){var i,e;for(e in this.songList)this.songDetail.id==this.songList[e]&&(i=e==this.songList.length-1?this.songList[0]:this.songList[Number(e)+1]);t.redirectTo({url:"/pages/detail/detail?songId="+i})},listenLyricIndex:function(){var t=this;clearInterval(this.timer),this.timer=setInterval((function(){for(var i=0;i<t.songLyric.length;i++){if(t.bgAudioManager.currentTime>t.songLyric[t.songLyric.length-1].time){t.lyricIndex=t.songLyric.length-1;break}t.bgAudioManager.currentTime>t.songLyric[i].time&&t.bgAudioManager.currentTime<t.songLyric[i+1].time&&(t.lyricIndex=i)}}),90)},cancelLyricIndex:function(){clearInterval(this.timer)},handleToSimi:function(t){this.getMusic(t)},MillisecondToDate:function(t){var i=new Date(t);function e(t){return t<10?"0"+t:t}return e(i.getMinutes())+":"+e(i.getSeconds())},checkcollect:function(t){var i=this;this.$u.utils.isLogin()?(0,n.userInfo)().then((function(t){i.useremail=t.data.email,(0,n.userCheckCollectMusicId)(i.useremail,i.songid).then((function(t){i.status=t.message,"true"==i.status?i.check=!1:i.check=!0}))})):this.check=!0},collect:function(t){this.$u.utils.isLogin()?(this.$u.toast("收藏成功"),(0,n.userCollectMusic)(this.useremail,t),this.check=!1):this.$u.toast("请先登录再收藏")},discollect:function(t){this.$u.utils.isLogin()?(this.$u.toast("取消收藏成功"),(0,n.userDisCollectMusic)(this.useremail,t),this.check=!0):this.$u.toast("请先登录再取消收藏")},moved:function(t){this.bgAudioManager.seek(t.detail.value),this.nowtimes=t.detail.value}}};i.default=o}).call(this,e("543d")["default"])},"4a2e":function(t,i,e){"use strict";e.d(i,"b",(function(){return o})),e.d(i,"c",(function(){return s})),e.d(i,"a",(function(){return n}));var n={musichead:function(){return e.e("components/musichead/musichead").then(e.bind(null,"d2c1"))}},o=function(){var t=this,i=t.$createElement;t._self._c},s=[]},"8c2f":function(t,i,e){"use strict";e.r(i);var n=e("4a2e"),o=e("358c");for(var s in o)"default"!==s&&function(t){e.d(i,t,(function(){return o[t]}))}(s);e("c2f3");var c,a=e("f0c5"),r=Object(a["a"])(o["default"],n["b"],n["c"],!1,null,"2867099c",null,!1,n["a"],c);i["default"]=r.exports},a054:function(t,i,e){"use strict";(function(t){e("63ed");n(e("66fd"));var i=n(e("8c2f"));function n(t){return t&&t.__esModule?t:{default:t}}wx.__webpack_require_UNI_MP_PLUGIN__=e,t(i.default)}).call(this,e("543d")["createPage"])},c2f3:function(t,i,e){"use strict";var n=e("fd31"),o=e.n(n);o.a},fd31:function(t,i,e){}},[["a054","common/runtime","common/vendor"]]]);